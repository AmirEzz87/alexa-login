<script>
const url = new URL(window.location.href);

const client_id = url.searchParams.get("client_id");
const redirect_uri = url.searchParams.get("redirect_uri");
const state = url.searchParams.get("state");

if (!client_id || !redirect_uri) {
    document.getElementById("error").innerText = "Missing parameters";
}

async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    try {
        const res = await fetch("https://mvmvqycvorstsftcldzs.supabase.co/functions/v1/auth-callback", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                email,
                password,
                redirect_uri,
                state
            })
        });

        const data = await res.json();

        if (!data.redirect_url) {
            document.getElementById("error").innerText = data.error || "Login failed";
            return;
        }

        window.location.href = data.redirect_url;
    } catch (err) {
        document.getElementById("error").innerText = "NetworkError";
    }
}
</script>
